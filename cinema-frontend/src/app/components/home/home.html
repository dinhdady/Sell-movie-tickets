<div class="home">
  <!-- Notifications -->
  <div class="notifications-container">
    <app-notification 
      *ngFor="let notification of notifications; let i = index"
      [notification]="notification"
      (closeNotification)="closeNotification(i)">
    </app-notification>
  </div>

  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-content">
      <div class="hero-text">
        <h1>Trải nghiệm điện ảnh tuyệt vời</h1>
        <p>Khám phá những bộ phim mới nhất với công nghệ chiếu phim hiện đại và âm thanh sống động</p>
        <div class="hero-buttons">
          <a routerLink="/movies" class="btn-primary">Xem phim ngay</a>
          <button class="btn-secondary" (click)="onBookTicketClick()" [disabled]="bookingLoading">
            <span *ngIf="!bookingLoading">Đặt vé</span>
            <span *ngIf="bookingLoading">Đang tải...</span>
          </button>
        </div>
      </div>
      <div class="hero-image">
        <div class="movie-poster">
          <img src="https://placehold.co/300x450?text=Movie+Poster" alt="Featured Movie">
          <div class="play-button">
            <i class="fas fa-play"></i>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Movies Section -->
  <section class="featured-movies">
    <div class="container">
      <div class="section-header">
        <h2>PHIM ĐỀ CỬ</h2>
        <a routerLink="/movies" class="view-all">Xem tất cả</a>
      </div>
      
      <div class="movies-grid">
        <div class="movie-card featured" *ngFor="let movie of (featuredMovies$ | async) || []">
          <div class="movie-poster">
            <img [src]="movie.posterUrl || 'https://placehold.co/250x375?text=Movie'" [alt]="movie.title">
            <div class="trending-badge">
              <span>Trending</span>
            </div>
            <div class="movie-status">
              <span>Hoàn Tất ({{ movie.episodes || 1 }}/{{ movie.episodes || 1 }}) Vietsub + Thuyết</span>
            </div>
            <div class="movie-overlay">
              <div class="movie-actions">
                <a [routerLink]="['/movies', movie.id]" class="btn-detail">Chi tiết</a>
                <a (click)="handleBookTicket(movie.id, $event)" class="btn-book">Đặt vé</a>
              </div>
            </div>
          </div>
          <div class="movie-info">
            <h3 class="vietnamese-title">{{ movie.title }}</h3>
            <h4 class="english-title">{{ movie.originalTitle || movie.title }}</h4>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Coming Soon Section -->
  <section class="coming-soon">
    <div class="container">
      <div class="section-header">
        <h2>Phim sắp chiếu</h2>
        <a routerLink="/movies" [queryParams]="{status: 'coming-soon'}" class="view-all">Xem tất cả</a>
      </div>
      
      <div class="movies-grid">
        <div class="movie-card coming-soon" *ngFor="let movie of comingSoonMovies$ | async">
          <div class="movie-poster">
            <img [src]="movie.posterUrl || 'https://placehold.co/250x375?text=Coming+Soon'" [alt]="movie.title">
            <div class="coming-soon-badge">
              <span>Sắp chiếu</span>
            </div>
            <div class="movie-overlay">
              <div class="movie-actions">
                <a [routerLink]="['/movies', movie.id]" class="btn-detail">Chi tiết</a>
              </div>
            </div>
          </div>
          <div class="movie-info">
            <h3>{{ movie.title }}</h3>
            <p class="movie-genre">{{ movie.genre }}</p>
            <p class="release-date" *ngIf="movie.status === 'COMING_SOON'">Khởi chiếu: {{ movie.releaseDate | date:'dd/MM/yyyy' }}</p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Movies by Category Section -->
  <section class="movies-by-category" *ngIf="!loading && ((genres$ | async) || []).length > 0">
    <div class="container">
      <div class="section-header">
        <h2>Phim theo thể loại</h2>
        <p>Khám phá phim theo sở thích của bạn</p>
      </div>
      
      <div class="category-sections">
            <div class="category-section" *ngFor="let genre of (genres$ | async) || []">
          <div class="category-header">
            <div class="category-info">
              <i [class]="getGenreIcon(genre)"></i>
              <h3>{{ genre }}</h3>
              <span class="movie-count">{{ (moviesByCategory$ | async)?.[genre]?.length || 0 }} phim</span>
            </div>
            <a [routerLink]="['/movies']" [queryParams]="{genre: genre}" class="view-all">Xem tất cả</a>
          </div>
          
          <div class="movies-grid">
            <div class="movie-card" *ngFor="let movie of (moviesByCategory$ | async)?.[genre]?.slice(0, 4) || []">
              <div class="movie-poster">
                <img [src]="movie.posterUrl || 'https://placehold.co/250x375?text=Movie'" [alt]="movie.title">
                <div class="movie-overlay">
                  <div class="movie-actions">
                    <a [routerLink]="['/movies', movie.id]" class="btn-detail">Chi tiết</a>
                    <a (click)="handleBookTicket(movie.id, $event)" class="btn-book" *ngIf="movie.status === 'NOW_SHOWING'">Đặt vé</a>
                  </div>
                </div>
                <div class="movie-rating" *ngIf="movie.rating > 0">
                  <span class="rating">{{ movie.rating }}/10</span>
                </div>
                <div class="coming-soon-badge" *ngIf="movie.status === 'COMING_SOON'">
                  <span>Sắp chiếu</span>
                </div>
              </div>
              <div class="movie-info">
                <h3>{{ movie.title }}</h3>
                <p class="movie-genre">{{ movie.genre }}</p>
                <p class="movie-duration" *ngIf="movie.duration">{{ movie.duration }} phút</p>
                <p class="release-date" *ngIf="movie.status === 'COMING_SOON'">Khởi chiếu: {{ movie.releaseDate | date:'dd/MM/yyyy' }}</p>
                <div class="movie-price" *ngIf="movie.status === 'NOW_SHOWING'">
                  <span class="price">{{ movie.price | currency:'VND' }}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Loading Section -->
  <section class="loading-section" *ngIf="loading">
    <div class="container">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <p>Đang tải danh sách phim...</p>
      </div>
    </div>
  </section>

  <!-- Error Section -->
  <section class="error-section" *ngIf="error">
    <div class="container">
      <div class="error-content">
        <i class="fas fa-exclamation-triangle"></i>
        <p>{{ error }}</p>
        <button (click)="reloadMovies()" class="btn-retry">Thử lại</button>
      </div>
    </div>
  </section>

  <!-- Empty State Section -->
  <section class="empty-state" *ngIf="!loading && !error && (featuredMovies$ | async)?.length === 0 && (comingSoonMovies$ | async)?.length === 0">
    <div class="container">
      <div class="empty-content">
        <i class="fas fa-film"></i>
        <h3>Chưa có phim nào</h3>
        <p>Hiện tại chưa có phim nào được thêm vào hệ thống.</p>
        <button (click)="reloadMovies()" class="btn-refresh">
          <i class="fas fa-sync-alt"></i>
          Tải lại
        </button>
      </div>
    </div>
  </section>

  <!-- Features Section -->
  <section class="features">
    <div class="container">
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-ticket-alt"></i>
          </div>
          <h3>Đặt vé dễ dàng</h3>
          <p>Đặt vé online nhanh chóng, thanh toán an toàn với nhiều phương thức</p>
        </div>
        
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-film"></i>
          </div>
          <h3>Công nghệ hiện đại</h3>
          <p>Hệ thống chiếu phim 4K, âm thanh Dolby Atmos chất lượng cao</p>
        </div>
        
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-couch"></i>
          </div>
          <h3>Ghế ngồi thoải mái</h3>
          <p>Ghế ngồi cao cấp, có thể điều chỉnh và massage tự động</p>
        </div>
        
        <div class="feature-card">
          <div class="feature-icon">
            <i class="fas fa-utensils"></i>
          </div>
          <h3>Dịch vụ ăn uống</h3>
          <p>Đặt đồ ăn và thức uống ngay tại chỗ, phục vụ tận nơi</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Newsletter Section -->
  <section class="newsletter">
    <div class="container">
      <div class="newsletter-content">
        <h2>Đăng ký nhận thông báo</h2>
        <p>Nhận thông báo về phim mới, ưu đãi đặc biệt và sự kiện sắp diễn ra</p>
        <div class="newsletter-form">
          <input type="email" placeholder="Nhập email của bạn" class="email-input" #emailInput>
          <button class="btn-subscribe" (click)="subscribeNewsletter(emailInput.value); emailInput.value = ''">Đăng ký</button>
        </div>
      </div>
    </div>
  </section>
</div>
