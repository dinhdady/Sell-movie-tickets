<div class="cinema-admin-container">
  <!-- Cinema Header -->
  <header class="cinema-header">
    <div class="glass-overlay"></div>
    <div class="header-left">
      <div class="cinema-logo">
        <div class="logo-icon">üé¨</div>
        <div class="logo-text">
          <h1>Cinema Pro</h1>
          <span>H·ªá th·ªëng qu·∫£n l√Ω r·∫°p chi·∫øu phim</span>
        </div>
      </div>
    </div>
    <div class="header-right">
      <div class="cinema-stats">
        <div class="stat-item">
          <span class="stat-number">{{ totalMovies }}</span>
          <span class="stat-label">Phim</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">{{ revenueStats.totalBookings }}</span>
          <span class="stat-label">ƒê·∫∑t v√©</span>
        </div>
        <div class="stat-item">
          <span class="stat-number">{{ formatCurrency(revenueStats.totalRevenue) }}</span>
          <span class="stat-label">Doanh thu</span>
        </div>
      </div>
      <div class="header-actions">
        <button class="action-btn refresh" (click)="forceRefresh()" title="L√†m m·ªõi">
          <i class="fas fa-sync-alt"></i>
        </button>
        <button class="action-btn dashboard" routerLink="/admin/dashboard" title="Dashboard">
          <i class="fas fa-tachometer-alt"></i>
        </button>
        <button class="action-btn list" (click)="showMovieList()" title="Danh s√°ch phim">
          <i class="fas fa-list"></i>
          <span>Danh s√°ch phim</span>
        </button>
        <button class="action-btn primary" (click)="resetForm()" title="Th√™m phim">
          <i class="fas fa-plus"></i>
          <span>Th√™m phim</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Box Office Stats -->
    <section class="box-office-section">
      <div class="section-header">
        <h2>Th·ªëng k√™ doanh thu</h2>
        <p>D·ªØ li·ªáu doanh thu v√† ƒë·∫∑t v√© r·∫°p chi·∫øu phim theo th·ªùi gian th·ª±c</p>
      </div>
      <div class="stats-grid">
        <div class="stat-card primary">
          <div class="card-glow"></div>
          <div class="card-icon">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="card-content">
            <h3>{{ formatCurrency(revenueStats.totalRevenue) }}</h3>
            <p>T·ªïng doanh thu</p>
            <div class="trend positive">
              <i class="fas fa-arrow-up"></i>
              <span>+15.2%</span>
            </div>
          </div>
        </div>
        <div class="stat-card secondary">
          <div class="card-glow"></div>
          <div class="card-icon">
            <i class="fas fa-ticket-alt"></i>
          </div>
          <div class="card-content">
            <h3>{{ revenueStats.totalBookings }}</h3>
            <p>T·ªïng ƒë·∫∑t v√©</p>
            <div class="trend positive">
              <i class="fas fa-arrow-up"></i>
              <span>+8.7%</span>
            </div>
          </div>
        </div>
        <div class="stat-card accent">
          <div class="card-glow"></div>
          <div class="card-icon">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="card-content">
            <h3>{{ formatCurrency(revenueStats.averageRevenue) }}</h3>
            <p>Doanh thu trung b√¨nh</p>
            <div class="trend positive">
              <i class="fas fa-arrow-up"></i>
              <span>+12.3%</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Movie Management -->
    <section class="management-section">
      <!-- Add Form (show when adding new movie) -->
      <div class="form-panel" *ngIf="!isEditing && isAdding">
        <div class="panel-header">
          <div class="header-info">
            <h2>Th√™m phim m·ªõi</h2>
            <p>T·∫°o m·ªôt b·ªô phim m·ªõi trong h·ªá th·ªëng</p>
          </div>
        </div>
        
        <form [formGroup]="movieForm" (ngSubmit)="onSubmit()" class="movie-form">
          <div class="form-sections">
            <!-- Basic Information -->
            <div class="form-section">
              <h3><i class="fas fa-film"></i> Th√¥ng tin c∆° b·∫£n</h3>
              <div class="form-grid">
                <div class="form-group">
                  <label>T√™n phim *</label>
                  <input type="text" formControlName="title" placeholder="Nh·∫≠p t√™n phim">
                </div>
                <div class="form-group">
                  <label>Th·ªÉ lo·∫°i *</label>
                  <input type="text" formControlName="genre" placeholder="H√†nh ƒë·ªông, T√¨nh c·∫£m, H√†i...">
                </div>
                <div class="form-group">
                  <label>ƒê·∫°o di·ªÖn *</label>
                  <input type="text" formControlName="director" placeholder="T√™n ƒë·∫°o di·ªÖn">
                </div>
                <div class="form-group">
                  <label>Di·ªÖn vi√™n *</label>
                  <input type="text" formControlName="cast" placeholder="T√™n di·ªÖn vi√™n ch√≠nh">
                </div>
              </div>
            </div>

            <!-- Technical Details -->
            <div class="form-section">
              <h3><i class="fas fa-cog"></i> Chi ti·∫øt k·ªπ thu·∫≠t</h3>
              <div class="form-grid">
                <div class="form-group">
                  <label>Th·ªùi l∆∞·ª£ng (ph√∫t) *</label>
                  <input type="number" formControlName="duration" placeholder="120">
                </div>
                <div class="form-group">
                  <label>ƒê√°nh gi√° (0-10) *</label>
                  <input type="number" formControlName="rating" min="0" max="10" step="0.1" placeholder="8.5">
                </div>
                <div class="form-group">
                  <label>Gi√° v√© (VND) *</label>
                  <input type="number" formControlName="price" placeholder="100000">
                </div>
                <div class="form-group">
                  <label>Ng√†y ph√°t h√†nh *</label>
                  <input type="date" formControlName="releaseDate">
                </div>
              </div>
            </div>

            <!-- Classification -->
            <div class="form-section">
              <h3><i class="fas fa-certificate"></i> Ph√¢n lo·∫°i & Tr·∫°ng th√°i</h3>
              <div class="form-grid">
                <div class="form-group">
                  <label>Tr·∫°ng th√°i *</label>
                  <select formControlName="status">
                    <option value="NOW_SHOWING">ƒêang chi·∫øu</option>
                    <option value="COMING_SOON">S·∫Øp chi·∫øu</option>
                    <option value="ENDED">ƒê√£ k·∫øt th√∫c</option>
                  </select>
                </div>
                <div class="form-group">
                  <label>ƒê·ªô tu·ªïi *</label>
                  <select formControlName="filmRating">
                    <option value="G">G - M·ªçi l·ª©a tu·ªïi</option>
                    <option value="PG">PG - C·∫ßn h∆∞·ªõng d·∫´n</option>
                    <option value="PG-13">PG-13 - 13+ tu·ªïi</option>
                    <option value="R">R - H·∫°n ch·∫ø</option>
                    <option value="NC-17">NC-17 - 18+ tu·ªïi</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Description & Media -->
            <div class="form-section">
              <h3><i class="fas fa-image"></i> M√¥ t·∫£ & H√¨nh ·∫£nh</h3>
              <div class="form-grid full-width">
                <div class="form-group">
                  <label>M√¥ t·∫£ phim *</label>
                  <textarea formControlName="description" rows="4" placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ b·ªô phim..."></textarea>
                </div>
                <div class="form-group">
                  <label>Poster phim</label>
                  <div class="file-upload">
                    <input type="file" accept="image/*" (change)="onFileSelected($event)">
                    <div class="upload-area">
                      <i class="fas fa-cloud-upload-alt"></i>
                      <span>Nh·∫•p ƒë·ªÉ t·∫£i poster</span>
                      <small>JPG, PNG, GIF (T·ªëi ƒëa 5MB)</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="btn-secondary" (click)="cancelEdit()">
              <i class="fas fa-times"></i>
              H·ªßy
            </button>
            <button type="submit" class="btn-primary" [disabled]="movieForm.invalid || loading">
              <i class="fas fa-plus"></i>
              {{ loading ? 'ƒêang x·ª≠ l√Ω...' : 'Th√™m phim' }}
            </button>
          </div>
        </form>
      </div>

      <!-- Movies Catalog -->
      <div class="table-panel" *ngIf="movies.length > 0 && !moviesLoading && !isAdding">
        <div class="panel-header">
          <div class="header-info">
            <h2>Danh s√°ch phim</h2>
            <p>Qu·∫£n l√Ω t·∫•t c·∫£ phim trong h·ªá th·ªëng r·∫°p chi·∫øu</p>
          </div>
          <div class="header-actions">
            <div class="search-box">
              <i class="fas fa-search"></i>
              <input type="text" placeholder="T√¨m ki·∫øm phim..." class="search-input">
            </div>
            <div class="view-toggle">
              <button class="toggle-btn active" title="Xem d·∫°ng b·∫£ng">
                <i class="fas fa-table"></i>
              </button>
              <button class="toggle-btn" title="Xem d·∫°ng l∆∞·ªõi">
                <i class="fas fa-th"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="table-container">
          <table class="movies-table">
            <thead>
              <tr>
                <th>Phim</th>
                <th>Th·ªÉ lo·∫°i</th>
                <th>Th·ªùi l∆∞·ª£ng</th>
                <th>ƒê√°nh gi√°</th>
                <th>Gi√° v√©</th>
                <th>Tr·∫°ng th√°i</th>
                <th>Thao t√°c</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let movie of movies">
                <td class="movie-cell">
                  <div class="movie-info">
                    <div class="movie-poster">
                      <img [src]="movie.posterUrl || 'https://via.placeholder.com/60x80/1a1a1a/ffffff?text=Kh√¥ng+c√≥+Poster'" [alt]="movie.title">
                    </div>
                    <div class="movie-details">
                      <h4>{{ movie.title }}</h4>
                      <p>{{ movie.director }}</p>
                      <span class="movie-meta">{{ movie.description | slice:0:60 }}{{ movie.description.length > 60 ? '...' : '' }}</span>
                    </div>
                  </div>
                </td>
                <td>
                  <span class="genre-tag">{{ movie.genre }}</span>
                </td>
                <td>
                  <span class="duration-badge">{{ movie.duration }} ph√∫t</span>
                </td>
                <td>
                  <span class="rating-badge" [ngClass]="getRatingBadgeClass(movie.rating)">
                    <i class="fas fa-star"></i>
                    {{ movie.rating }}/10
                  </span>
                </td>
                <td>
                  <span class="price-tag">{{ formatCurrency(movie.price) }}</span>
                </td>
                <td>
                  <span class="status-badge" [ngClass]="getStatusBadgeClass(movie.status)">
                    <i class="fas" [class.fa-play]="movie.status === 'NOW_SHOWING'" [class.fa-calendar]="movie.status === 'COMING_SOON'" [class.fa-stop]="movie.status === 'ENDED'"></i>
                    {{ getStatusText(movie.status) }}
                  </span>
                </td>
                <td class="actions-cell">
                  <div class="action-buttons">
                    <button class="action-btn edit" (click)="editMovie(movie)" title="Ch·ªânh s·ª≠a">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="action-btn view" title="Xem chi ti·∫øt">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="action-btn delete" (click)="deleteMovie(movie.id!)" title="X√≥a">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="pagination-wrapper" *ngIf="totalPages > 1">
          <div class="pagination-info">
            <span>Hi·ªÉn th·ªã {{ currentPage * pageSize + 1 }} ƒë·∫øn {{ Math.min((currentPage + 1) * pageSize, totalMovies) }} trong t·ªïng s·ªë {{ totalMovies }} phim</span>
          </div>
          <div class="pagination-controls">
            <button class="pagination-btn" (click)="prevPage()" [disabled]="currentPage === 0">
              <i class="fas fa-chevron-left"></i>
              Tr∆∞·ªõc
            </button>
            
            <div class="page-numbers">
              <button 
                *ngFor="let page of [].constructor(totalPages); let i = index" 
                class="page-btn" 
                [class.active]="currentPage === i"
                (click)="goToPage(i)">
                {{ i + 1 }}
              </button>
            </div>
            
            <button class="pagination-btn" (click)="nextPage()" [disabled]="currentPage === totalPages - 1">
              Sau
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="movies.length === 0 && !moviesLoading && !isAdding">
        <div class="empty-content">
          <div class="empty-icon">
            <i class="fas fa-film"></i>
          </div>
          <h3>Ch∆∞a c√≥ phim n√†o</h3>
          <p>B·∫Øt ƒë·∫ßu b·∫±ng c√°ch th√™m phim ƒë·∫ßu ti√™n v√†o h·ªá th·ªëng</p>
          <button class="btn-primary" (click)="resetForm()">
            <i class="fas fa-plus"></i>
            Th√™m phim ƒë·∫ßu ti√™n
          </button>
        </div>
      </div>
    </section>
  </main>

  <!-- Edit Movie Modal -->
  <div class="modal-overlay" *ngIf="isEditing" (click)="cancelEdit()">
    <div class="modal-container" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Ch·ªânh s·ª≠a phim</h2>
        <button class="modal-close" (click)="cancelEdit()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <form [formGroup]="movieForm" (ngSubmit)="onSubmit()" class="modal-form">
        <div class="form-sections">
          <!-- Basic Information -->
          <div class="form-section">
            <h3><i class="fas fa-film"></i> Th√¥ng tin c∆° b·∫£n</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>T√™n phim *</label>
                <input type="text" formControlName="title" placeholder="Nh·∫≠p t√™n phim">
              </div>
              <div class="form-group">
                <label>Th·ªÉ lo·∫°i *</label>
                <input type="text" formControlName="genre" placeholder="H√†nh ƒë·ªông, T√¨nh c·∫£m, H√†i...">
              </div>
              <div class="form-group">
                <label>ƒê·∫°o di·ªÖn *</label>
                <input type="text" formControlName="director" placeholder="T√™n ƒë·∫°o di·ªÖn">
              </div>
              <div class="form-group">
                <label>Di·ªÖn vi√™n *</label>
                <input type="text" formControlName="cast" placeholder="T√™n di·ªÖn vi√™n ch√≠nh">
              </div>
            </div>
          </div>

          <!-- Technical Details -->
          <div class="form-section">
            <h3><i class="fas fa-cog"></i> Chi ti·∫øt k·ªπ thu·∫≠t</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>Th·ªùi l∆∞·ª£ng (ph√∫t) *</label>
                <input type="number" formControlName="duration" placeholder="120">
              </div>
              <div class="form-group">
                <label>ƒê√°nh gi√° (0-10) *</label>
                <input type="number" formControlName="rating" min="0" max="10" step="0.1" placeholder="8.5">
              </div>
              <div class="form-group">
                <label>Gi√° v√© (VND) *</label>
                <input type="number" formControlName="price" placeholder="100000">
              </div>
              <div class="form-group">
                <label>Ng√†y ph√°t h√†nh *</label>
                <input type="date" formControlName="releaseDate">
              </div>
            </div>
          </div>

          <!-- Classification -->
          <div class="form-section">
            <h3><i class="fas fa-certificate"></i> Ph√¢n lo·∫°i & Tr·∫°ng th√°i</h3>
            <div class="form-grid">
              <div class="form-group">
                <label>Tr·∫°ng th√°i *</label>
                <select formControlName="status">
                  <option value="NOW_SHOWING">ƒêang chi·∫øu</option>
                  <option value="COMING_SOON">S·∫Øp chi·∫øu</option>
                  <option value="ENDED">ƒê√£ k·∫øt th√∫c</option>
                </select>
              </div>
              <div class="form-group">
                <label>ƒê·ªô tu·ªïi *</label>
                <select formControlName="filmRating">
                  <option value="G">G - M·ªçi l·ª©a tu·ªïi</option>
                  <option value="PG">PG - C·∫ßn h∆∞·ªõng d·∫´n</option>
                  <option value="PG-13">PG-13 - 13+ tu·ªïi</option>
                  <option value="R">R - H·∫°n ch·∫ø</option>
                  <option value="NC-17">NC-17 - 18+ tu·ªïi</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Description & Media -->
          <div class="form-section">
            <h3><i class="fas fa-image"></i> M√¥ t·∫£ & H√¨nh ·∫£nh</h3>
            <div class="form-grid full-width">
              <div class="form-group">
                <label>M√¥ t·∫£ phim *</label>
                <textarea formControlName="description" rows="4" placeholder="M√¥ t·∫£ chi ti·∫øt v·ªÅ b·ªô phim..."></textarea>
              </div>
              <div class="form-group">
                <label>Poster phim</label>
                <div class="file-upload">
                  <input type="file" accept="image/*" (change)="onFileSelected($event)">
                  <div class="upload-area">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <span>Nh·∫•p ƒë·ªÉ t·∫£i poster</span>
                    <small>JPG, PNG, GIF (T·ªëi ƒëa 5MB)</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-secondary" (click)="cancelEdit()">
            <i class="fas fa-times"></i>
            H·ªßy
          </button>
          <button type="submit" class="btn-primary" [disabled]="movieForm.invalid || loading">
            <i class="fas fa-save"></i>
            {{ loading ? 'ƒêang x·ª≠ l√Ω...' : 'C·∫≠p nh·∫≠t phim' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="loading-modal">
      <div class="loading-spinner">
        <div class="spinner-ring"></div>
        <div class="spinner-core"></div>
      </div>
      <div class="loading-content">
        <h3>ƒêang t·∫£i d·ªØ li·ªáu</h3>
        <p>Vui l√≤ng ch·ªù trong khi ch√∫ng t√¥i l·∫•y th√¥ng tin m·ªõi nh·∫•t...</p>
      </div>
    </div>
  </div>
</div>
