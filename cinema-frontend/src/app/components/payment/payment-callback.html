<div class="payment-callback">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Đang xác thực kết quả thanh toán...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="!loading && paymentStatus === 'failed'" class="error-state">
      <h3>Thanh toán thất bại</h3>
      <p>{{ error }}</p>
      <button (click)="navigateToHome()" class="btn-home">
        <i class="fas fa-arrow-left"></i>
        Quay lại
      </button>
  </div>
  
  <!-- Success State -->
  <div *ngIf="!loading && paymentStatus === 'success' && paymentDetails" class="ticket-wrapper">
    <div class="ticket-header success">
      <div class="icon"><i class="fas fa-check-circle"></i></div>
      <h2>Thanh toán thành công!</h2>
    </div>

    <div class="ticket-body">
      <div class="info-grid">
        <div class="info-item">
          <span class="label">Mã đơn hàng</span>
          <span class="value">{{ paymentDetails.orderId }}</span>
        </div>
        <div class="info-item">
          <span class="label">Thông báo</span>
          <span class="value">{{ paymentDetails.message }}</span>
        </div>
        <div class="info-item" *ngIf="paymentDetails.tickets && paymentDetails.tickets.length > 0">
          <span class="label">Số lượng vé</span>
          <span class="value">{{ paymentDetails.tickets.length }} vé</span>
        </div>
        
        <div class="info-item" *ngIf="paymentDetails.movieTitle">
          <span class="label">Phim</span>
          <span class="value">{{ paymentDetails.movieTitle }}</span>
        </div>
        
        <div class="info-item" *ngIf="paymentDetails.cinemaName">
          <span class="label">Rạp</span>
          <span class="value">{{ paymentDetails.cinemaName }}</span>
        </div>
        
        <div class="info-item" *ngIf="paymentDetails.roomName">
          <span class="label">Phòng</span>
          <span class="value">{{ paymentDetails.roomName }}</span>
        </div>
        
        <div class="info-item" *ngIf="paymentDetails.showtime">
          <span class="label">Suất chiếu</span>
          <span class="value">{{ paymentDetails.showtime }}</span>
        </div>
        
        <div class="info-item" *ngIf="paymentDetails.tickets && paymentDetails.tickets.length > 0">
          <span class="label">Ghế</span>
          <div class="value seats">
            <span *ngFor="let ticket of paymentDetails.tickets" class="seat-tag">
              {{ ticket.seat?.seatNumber }}
            </span>
          </div>
        </div>
        <div class="info-item" *ngIf="paymentDetails.qrCodes && paymentDetails.qrCodes.length > 0">
          <span class="label">Mã QR:</span>
          <div class="qr-codes-container">
            <img *ngFor="let qrCode of paymentDetails.qrCodes; let i = index" 
                 [src]="'data:image/png;base64,' + qrCode" 
                 [alt]="'QR Code vé ' + (i + 1)" 
                 class="qr-image">
          </div>
        </div>
      </div>

      <div class="tickets-section" *ngIf="paymentDetails.tickets && paymentDetails.tickets.length > 0">
        <span class="label">Chi tiết vé</span>
        <div class="tickets-list">
          <div *ngFor="let ticket of paymentDetails.tickets; let i = index" class="ticket-item">
            <div class="ticket-number">Vé #{{ i + 1 }}</div>
            <div class="ticket-details">
              <div class="seat-info">Ghế: {{ ticket.seat?.seatNumber }}</div>
              <div class="price">Giá: {{ ticket.price | currency:'VND':'symbol':'1.0-0' }}</div>
              <div class="qr-code" *ngIf="ticket.qrCode">
                <span class="label">Mã QR:</span>
                <img [src]="'data:image/png;base64,' + ticket.qrCode" alt="QR Code" class="qr-image">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="ticket-footer">
      <p>Vui lòng đưa mã QR này cho nhân viên tại quầy vé. Vé cũng đã được gửi đến email của bạn.</p>
      <div class="action-buttons">
        <button (click)="navigateToHome()" class="btn-home">
          <i class="fas fa-home"></i>
          Về trang chủ
        </button>
        <button (click)="navigateToMyTickets()" class="btn-tickets">
          <i class="fas fa-ticket-alt"></i>
          Xem vé của tôi
        </button>
      </div>
    </div>
  </div>
</div> 