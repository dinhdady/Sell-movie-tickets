# Script ƒë·ªÉ x√≥a showtime an to√†n
param(
    [Parameter(Mandatory=$true)]
    [int]$ShowtimeId
)

Write-Host "üóëÔ∏è  Deleting showtime ID: $ShowtimeId" -ForegroundColor Yellow

# Ki·ªÉm tra xem c√≥ booking n√†o kh√¥ng
Write-Host "üîç Checking for associated bookings..." -ForegroundColor Blue
$bookings = Invoke-RestMethod -Uri "http://localhost:8080/api/showtime/$ShowtimeId/can-delete" -Method GET
Write-Host "Can delete: $($bookings.data.canDelete)" -ForegroundColor Cyan

if ($bookings.data.canDelete -eq $false) {
    Write-Host "‚ùå Cannot delete showtime - has associated bookings" -ForegroundColor Red
    Write-Host "Use force delete to remove all related data" -ForegroundColor Yellow
    
    $confirm = Read-Host "Do you want to force delete? (y/N)"
    if ($confirm -eq "y" -or $confirm -eq "Y") {
        Write-Host "üö® Force deleting showtime and all related data..." -ForegroundColor Red
        try {
            $result = Invoke-RestMethod -Uri "http://localhost:8080/api/showtime/$ShowtimeId/force" -Method DELETE
            Write-Host "‚úÖ $($result.message)" -ForegroundColor Green
        } catch {
            Write-Host "‚ùå Error: $($_.Exception.Message)" -ForegroundColor Red
        }
    } else {
        Write-Host "‚ùå Deletion cancelled" -ForegroundColor Yellow
    }
} else {
    Write-Host "‚úÖ Safe to delete showtime" -ForegroundColor Green
    try {
        $result = Invoke-RestMethod -Uri "http://localhost:8080/api/showtime/$ShowtimeId" -Method DELETE
        Write-Host "‚úÖ $($result.message)" -ForegroundColor Green
    } catch {
        Write-Host "‚ùå Error: $($_.Exception.Message)" -ForegroundColor Red
    }
}

Write-Host "üèÅ Script completed" -ForegroundColor Blue
