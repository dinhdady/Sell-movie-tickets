# Script c√†i ƒë·∫∑t Maven v√† ch·∫°y ·ª©ng d·ª•ng
Write-Host "üöÄ Installing Maven and running application..." -ForegroundColor Green

# Ki·ªÉm tra xem Maven ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t ch∆∞a
try {
    $mavenVersion = mvn -version 2>$null
    if ($LASTEXITCODE -eq 0) {
        Write-Host "‚úÖ Maven is already installed" -ForegroundColor Green
        Write-Host $mavenVersion
    }
} catch {
    Write-Host "‚ùå Maven not found. Installing..." -ForegroundColor Yellow
    
    # C√†i ƒë·∫∑t Maven qua Chocolatey
    try {
        # Ki·ªÉm tra Chocolatey
        $chocoVersion = choco --version 2>$null
        if ($LASTEXITCODE -eq 0) {
            Write-Host "‚úÖ Chocolatey found. Installing Maven..." -ForegroundColor Green
            choco install maven -y
        } else {
            Write-Host "‚ùå Chocolatey not found. Installing Chocolatey first..." -ForegroundColor Yellow
            # C√†i ƒë·∫∑t Chocolatey
            Set-ExecutionPolicy Bypass -Scope Process -Force
            [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
            iex ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
            
            # C√†i ƒë·∫∑t Maven
            choco install maven -y
        }
    } catch {
        Write-Host "‚ùå Failed to install Maven via Chocolatey. Please install manually." -ForegroundColor Red
        Write-Host "Download from: https://maven.apache.org/download.cgi" -ForegroundColor Yellow
        exit 1
    }
}

# Ki·ªÉm tra l·∫°i Maven
try {
    $mavenVersion = mvn -version
    Write-Host "‚úÖ Maven installed successfully!" -ForegroundColor Green
} catch {
    Write-Host "‚ùå Maven installation failed" -ForegroundColor Red
    exit 1
}

# Build v√† ch·∫°y ·ª©ng d·ª•ng
Write-Host "üî® Building application..." -ForegroundColor Blue
mvn clean package -DskipTests

if ($LASTEXITCODE -eq 0) {
    Write-Host "‚úÖ Build successful!" -ForegroundColor Green
    
    Write-Host "üöÄ Starting application..." -ForegroundColor Blue
    java -jar target/movie-0.0.1-SNAPSHOT.jar
} else {
    Write-Host "‚ùå Build failed!" -ForegroundColor Red
    exit 1
}
