# Script ƒë·ªÉ ki·ªÉm tra booking v·ªõi token
Write-Host "üîç Checking booking with token..." -ForegroundColor Yellow

# ƒêƒÉng nh·∫≠p ƒë·ªÉ l·∫•y token
Write-Host "`nüîç Login to get token..." -ForegroundColor Blue
$loginData = @{
    username = "user1"
    password = "password123"
} | ConvertTo-Json

try {
    $loginResponse = Invoke-RestMethod -Uri "http://localhost:8080/api/auth/login" -Method POST -Body $loginData -ContentType "application/json"
    Write-Host "‚úÖ Login successful!" -ForegroundColor Green
    $token = $loginResponse.object.accessToken
    Write-Host "Token: $token" -ForegroundColor Cyan
} catch {
    Write-Host "‚ùå Login failed: $($_.Exception.Message)" -ForegroundColor Red
    exit 1
}

$headers = @{
    "Authorization" = "Bearer $token"
    "Content-Type" = "application/json"
}

# Ki·ªÉm tra order 299
Write-Host "`nüîç Checking Order 299..." -ForegroundColor Blue
try {
    $orderResponse = Invoke-RestMethod -Uri "http://localhost:8080/api/order/299" -Method GET -Headers $headers
    Write-Host "‚úÖ Order 299 details:" -ForegroundColor Green
    Write-Host ($orderResponse | ConvertTo-Json -Depth 3) -ForegroundColor White
} catch {
    Write-Host "‚ùå Order 299 error: $($_.Exception.Message)" -ForegroundColor Red
}

# Ki·ªÉm tra booking m·ªõi nh·∫•t
Write-Host "`nüîç Checking latest bookings..." -ForegroundColor Blue
try {
    $bookingsResponse = Invoke-RestMethod -Uri "http://localhost:8080/api/booking" -Method GET -Headers $headers
    Write-Host "‚úÖ Latest bookings:" -ForegroundColor Green
    Write-Host ($bookingsResponse | ConvertTo-Json -Depth 3) -ForegroundColor White
} catch {
    Write-Host "‚ùå Bookings error: $($_.Exception.Message)" -ForegroundColor Red
}

# Ki·ªÉm tra showtime 6
Write-Host "`nüîç Checking Showtime 6..." -ForegroundColor Blue
try {
    $showtimeResponse = Invoke-RestMethod -Uri "http://localhost:8080/api/showtime/6" -Method GET -Headers $headers
    Write-Host "‚úÖ Showtime 6 details:" -ForegroundColor Green
    Write-Host ($showtimeResponse | ConvertTo-Json -Depth 3) -ForegroundColor White
} catch {
    Write-Host "‚ùå Showtime 6 error: $($_.Exception.Message)" -ForegroundColor Red
}

Write-Host "`nüèÅ Booking check with token completed" -ForegroundColor Green
