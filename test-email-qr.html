<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Test QR Code Email</title>
</head>
<body>
    <h1>Test QR Code Email</h1>
    
    <div id="qr-container">
        <h3>QR Code Test</h3>
        <div id="qr-code"></div>
        <p id="qr-data"></p>
        <p id="qr-info"></p>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
        async function testQRCode() {
            const testData = 'TICKET_test-token-123456789';
            const qrContainer = document.getElementById('qr-code');
            const qrDataElement = document.getElementById('qr-data');
            const qrInfoElement = document.getElementById('qr-info');
            
            try {
                // Generate QR code
                const qrCodeDataUrl = await QRCode.toDataURL(testData, {
                    width: 150,
                    margin: 1,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    },
                    errorCorrectionLevel: 'M'
                });
                
                // Display QR code
                const img = document.createElement('img');
                img.src = qrCodeDataUrl;
                img.style.width = '150px';
                img.style.height = '150px';
                img.style.border = '2px solid #333';
                img.style.borderRadius = '8px';
                qrContainer.appendChild(img);
                
                // Display info
                qrDataElement.textContent = `QR Data: ${testData}`;
                qrInfoElement.innerHTML = `
                    <strong>QR Code Info:</strong><br>
                    Data URL Length: ${qrCodeDataUrl.length} characters<br>
                    Data URL Preview: ${qrCodeDataUrl.substring(0, 100)}...<br>
                    <br>
                    <strong>Email Test:</strong><br>
                    <button onclick="testEmail()">Send Test Email</button>
                `;
                
                console.log('QR Code generated successfully');
                console.log('Data URL length:', qrCodeDataUrl.length);
                console.log('Data URL preview:', qrCodeDataUrl.substring(0, 100));
                
            } catch (error) {
                console.error('Error generating QR code:', error);
                qrInfoElement.textContent = 'Error generating QR code: ' + error.message;
            }
        }
        
        async function testEmail() {
            const testData = 'TICKET_test-token-123456789';
            
            try {
                // Generate QR code for email
                const qrCodeDataUrl = await QRCode.toDataURL(testData, {
                    width: 150,
                    margin: 1,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    },
                    errorCorrectionLevel: 'M'
                });
                
                // Create HTML email content
                const htmlContent = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test QR Code Email</title>
    <style>
        body { font-family: Arial, sans-serif; line-height: 1.4; color: #333; max-width: 500px; margin: 0 auto; padding: 15px; background-color: #f8fafc; }
        .container { background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .header { background: linear-gradient(135deg, #1f2937, #374151); color: white; padding: 15px; text-align: center; border-radius: 8px 8px 0 0; margin: -20px -20px 20px -20px; }
        .qr-section { text-align: center; margin: 20px 0; padding: 15px; background-color: #f1f5f9; border-radius: 6px; border: 1px dashed #cbd5e1; }
        .qr-section img { width: 150px; height: 150px; border: 2px solid #333; border-radius: 8px; display: block; margin: 0 auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé¨ Test QR Code Email</h1>
        </div>
        
        <p>This is a test email to check QR code display.</p>
        
        <div class="qr-section">
            <h3>üéüÔ∏è Test QR Code</h3>
            <img src="${qrCodeDataUrl}" alt="QR Code v√©" />
            <p><strong>QR Data:</strong> ${testData}</p>
            <p>If you can see the QR code above, email display is working correctly.</p>
        </div>
    </div>
</body>
</html>
                `;
                
                // Send test email
                const response = await fetch('http://localhost:8080/api/booking/test-html-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        htmlContent: htmlContent,
                        toEmail: 'dinhhoang22072004@gmail.com'
                    })
                });
                
                if (response.ok) {
                    alert('Test email sent successfully! Check your inbox.');
                } else {
                    const error = await response.text();
                    alert('Failed to send test email: ' + error);
                }
                
            } catch (error) {
                console.error('Error sending test email:', error);
                alert('Error sending test email: ' + error.message);
            }
        }
        
        // Run test when page loads
        testQRCode();
    </script>
</body>
</html>
