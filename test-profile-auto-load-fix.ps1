# Test script ƒë·ªÉ ki·ªÉm tra Profile page t·ª± ƒë·ªông load v√© sau khi fix
Write-Host "üé¨ Testing Profile Page Auto-Load Fix" -ForegroundColor Cyan
Write-Host "=====================================" -ForegroundColor Cyan

$baseUrl = "http://localhost:8080/api"

Write-Host "`n1. Testing API endpoints..." -ForegroundColor Yellow

# Test primary API
try {
    $response = Invoke-RestMethod -Uri "$baseUrl/tickets/test" -Method GET
    Write-Host "‚úÖ /api/tickets/test - Working ($($response.object.Count) tickets)" -ForegroundColor Green
    
    # Test filtering
    $testEmails = @("dinhhoang2207004@gmail.com", "hoangphuong16680@gmail.com")
    foreach ($email in $testEmails) {
        $userTickets = $response.object | Where-Object { $_.customerEmail -eq $email }
        Write-Host "  üìß $email : $($userTickets.Count) tickets" -ForegroundColor White
    }
} catch {
    Write-Host "‚ùå /api/tickets/test - Error: $($_.Exception.Message)" -ForegroundColor Red
}

# Test profile API
try {
    $response = Invoke-RestMethod -Uri "$baseUrl/user/profile" -Method GET
    Write-Host "‚úÖ /api/user/profile - Working" -ForegroundColor Green
    Write-Host "  User email: $($response.object.email)" -ForegroundColor White
} catch {
    Write-Host "‚ùå /api/user/profile - Error: $($_.Exception.Message)" -ForegroundColor Red
    Write-Host "  This might be due to missing authentication" -ForegroundColor Yellow
}

Write-Host "`n2. Expected Behavior After Fix:" -ForegroundColor Cyan
Write-Host "===============================" -ForegroundColor Cyan
Write-Host "‚úÖ Page should automatically load bookings on first visit" -ForegroundColor Green
Write-Host "‚úÖ No need to click 'L√†m m·ªõi' button" -ForegroundColor Green
Write-Host "‚úÖ Bookings should appear immediately" -ForegroundColor Green
Write-Host "‚úÖ Console should show debug logs" -ForegroundColor Green

Write-Host "`n3. Debug Steps:" -ForegroundColor Yellow
Write-Host "===============" -ForegroundColor Yellow
Write-Host "1. Open browser and go to http://localhost:5173/profile" -ForegroundColor White
Write-Host "2. Open Developer Tools (F12) ‚Üí Console tab" -ForegroundColor White
Write-Host "3. Look for these log messages:" -ForegroundColor White
Write-Host "   - 'üéØ [Profile] Starting fetchUserData...'" -ForegroundColor Gray
Write-Host "   - 'üéØ [Profile] Using email: [email]'" -ForegroundColor Gray
Write-Host "   - 'üéØ [Profile] Initial load - trying test API...'" -ForegroundColor Gray
Write-Host "   - 'üéØ [Profile] Filtered user bookings: [array]'" -ForegroundColor Gray

Write-Host "`n4. If Still Not Working:" -ForegroundColor Red
Write-Host "=========================" -ForegroundColor Red
Write-Host "Check these potential issues:" -ForegroundColor White
Write-Host "‚Ä¢ User not logged in (no authUser)" -ForegroundColor White
Write-Host "‚Ä¢ Email mismatch between authUser and booking data" -ForegroundColor White
Write-Host "‚Ä¢ API endpoint not responding" -ForegroundColor White
Write-Host "‚Ä¢ JavaScript errors in console" -ForegroundColor White

Write-Host "`n5. Manual Test:" -ForegroundColor Magenta
Write-Host "===============" -ForegroundColor Magenta
Write-Host "If auto-load still doesn't work, try:" -ForegroundColor White
Write-Host "‚Ä¢ Click 'L√†m m·ªõi' button to test manual refresh" -ForegroundColor White
Write-Host "‚Ä¢ Check if bookings appear after manual refresh" -ForegroundColor White
Write-Host "‚Ä¢ This confirms the API is working, just auto-load needs fixing" -ForegroundColor White
