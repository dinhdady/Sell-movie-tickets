# Script ƒë·ªÉ test x√≥a showtime
param(
    [Parameter(Mandatory=$true)]
    [int]$ShowtimeId
)

Write-Host "üß™ Testing showtime deletion for ID: $ShowtimeId" -ForegroundColor Yellow

# 1. Ki·ªÉm tra showtime c√≥ t·ªìn t·∫°i kh√¥ng
Write-Host "üîç Checking if showtime exists..." -ForegroundColor Blue
try {
    $showtime = Invoke-RestMethod -Uri "http://localhost:8080/api/showtime/$ShowtimeId" -Method GET
    Write-Host "‚úÖ Showtime found: $($showtime.data.startTime)" -ForegroundColor Green
} catch {
    Write-Host "‚ùå Showtime not found: $($_.Exception.Message)" -ForegroundColor Red
    exit 1
}

# 2. Ki·ªÉm tra c√≥ th·ªÉ x√≥a kh√¥ng
Write-Host "üîç Checking if showtime can be deleted..." -ForegroundColor Blue
try {
    $canDelete = Invoke-RestMethod -Uri "http://localhost:8080/api/showtime/$ShowtimeId/can-delete" -Method GET
    Write-Host "Can delete: $($canDelete.data.canDelete)" -ForegroundColor Cyan
} catch {
    Write-Host "‚ùå Error checking deletion: $($_.Exception.Message)" -ForegroundColor Red
}

# 3. Th·ª≠ x√≥a b√¨nh th∆∞·ªùng
Write-Host "üóëÔ∏è  Attempting normal deletion..." -ForegroundColor Blue
try {
    $result = Invoke-RestMethod -Uri "http://localhost:8080/api/showtime/$ShowtimeId" -Method DELETE
    Write-Host "‚úÖ $($result.message)" -ForegroundColor Green
} catch {
    Write-Host "‚ùå Normal deletion failed: $($_.Exception.Message)" -ForegroundColor Red
    
    # 4. Th·ª≠ x√≥a cascade
    Write-Host "üóëÔ∏è  Attempting cascade deletion..." -ForegroundColor Blue
    try {
        $result = Invoke-RestMethod -Uri "http://localhost:8080/api/showtime/$ShowtimeId/cascade" -Method DELETE
        Write-Host "‚úÖ $($result.message)" -ForegroundColor Green
    } catch {
        Write-Host "‚ùå Cascade deletion failed: $($_.Exception.Message)" -ForegroundColor Red
        
        # 5. Th·ª≠ x√≥a force
        Write-Host "üóëÔ∏è  Attempting force deletion..." -ForegroundColor Blue
        try {
            $result = Invoke-RestMethod -Uri "http://localhost:8080/api/showtime/$ShowtimeId/force" -Method DELETE
            Write-Host "‚úÖ $($result.message)" -ForegroundColor Green
        } catch {
            Write-Host "‚ùå Force deletion failed: $($_.Exception.Message)" -ForegroundColor Red
        }
    }
}

Write-Host "üèÅ Test completed" -ForegroundColor Blue
